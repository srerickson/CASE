%div.container(ng-app="boi" ng-controller="EvaluationSetController" ng-init="init(#{@id})")

  %table.span7.evaluation_results(ng-class="{sort_asc: sort_order == 'asc', sort_desc: sort_order != 'asc' }")
    %thead
      %tr
        %th(ng-class="{active_sort: sort_field == 'name' }") 
          %a.field_name(ng-click=" set_sort_field('name') ")
            Name         
          %span.toggle_sort(ng-click="toggle_sort_order()")
            %span.entypo
        %th(ng-repeat="question in show_questions"
            ng-class="{active_sort: sort_field == question.position}")

          %a.field_name(ng-click="set_sort_field(question.position)"
            popover="{{question.question}}" 
            popover-trigger="mouseenter" 
            popover-placement="bottom") {{question.position}}
          %span.toggle_sort(ng-click="toggle_sort_order()")
            %span.entypo

    %tbody

      // Bird Row
      %tr(ng-repeat="b in birds" 
           ng-controller="BirdResultController" 
           ng-init="bird = b"
           ng-class="{ active_sort: sort_field == bird }")

        %td 
          {{ bird.name }}
          .hint
            %a.proximity_sort(ng-click=" set_sort_field(bird) ")
              proximity sort
          .hint(ng-show="sort_type == 'proximity' ")
            distance: {{bird.distance | number:4}}


        %td(ng-repeat="question in $parent.show_questions")

          %div(popover-template="/assets/frontend/evaluation_set/pie_popup.html" 
            popover-trigger="mouseenter" 
            popover-placement="top"
            ng-click="load_response_details(question)")

            .evaluation_result_pie(case-result-pie
              ng-model = "bird.results[question.id]"
              sub-question="$parent.is_sub_question(question)")

  %div(ng-controller="ResponseDetailsController" ng-show="show")
    .span4#response_details(style="position:fixed")
      .row-fluid
        .span1
        .span10
          %strong EVALUATION RESPONSE DETAILS
        .span1
          .entypo.cross(ng-click="show = false")
      .row-fluid
        .span3 
          %h6 Case
        .span9 
          %img(ng-src="{{bird.thumbnail_100_url}}" ng-show="bird.thumbnail_100_url")
          {{bird.name}}
      .row-fluid
        .span3 
          %h6 Question
        .span9 {{question.question}}
      .row-fluid
        .span3 
          %h6 Responses
        .span9 
          Yes: {{answers_of_type('YES').length}},
          No: {{answers_of_type('NO').length}},
          N/A: {{answers_of_type('N/A').length}}

      .row-fluid(ng-show=" comments_for_answer_type('YES').length ")
        .span3
          %h6 YES Comments
        %ul.span9           
          %li(ng-repeat="a in comments_for_answer_type('YES') ")
            "{{a}}"

      .row-fluid(ng-show=" comments_for_answer_type('NO').length ")
        .span3
          %h6 NO Comments
        %ul.span9           
          %li(ng-repeat="a in comments_for_answer_type('NO') ")
            "{{a}}"

      .row-fluid(ng-show=" comments_for_answer_type('N/A').length ")
        .span3
          %h6 N/A Comments
        %ul.span9           
          %li(ng-repeat="a in comments_for_answer_type('N/A') ")
            "{{a}}"
    
